

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>More Advanced Eryn Examples &mdash; Eryn 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Code Projects" href="../general/todos.html" />
    <link rel="prev" title="Eryn Basic Tutorial" href="Eryn_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: coral" >

          
          
          <a href="../index.html" class="icon icon-home">
            Eryn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/ensemble.html">Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/state.html">State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/backend.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/moves.html">Moves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/prior.html">Priors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/temper.html">Parallel Tempering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/utils.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Eryn_tutorial.html">Eryn Basic Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">More Advanced Eryn Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Searching-for-Gaussian-pulses-in-2D">Searching for Gaussian pulses in 2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Choosing-the-optimal-B-Spline-order">Choosing the optimal B-Spline order</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">General Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/todos.html">Code Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/todos.html#code-todos">Code TODOs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: coral" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Eryn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">More Advanced Eryn Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/more_tutorials.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="Eryn_tutorial.html" class="btn btn-neutral float-left" title="Eryn Basic Tutorial" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../general/todos.html" class="btn btn-neutral float-right" title="Code Projects" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="More-Advanced-Eryn-Examples">
<h1>More Advanced Eryn Examples<a class="headerlink" href="#More-Advanced-Eryn-Examples" title="Link to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">eryn.ensemble</span> <span class="kn">import</span> <span class="n">EnsembleSampler</span>
<span class="kn">from</span> <span class="nn">eryn.state</span> <span class="kn">import</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">eryn.prior</span> <span class="kn">import</span> <span class="n">ProbDistContainer</span><span class="p">,</span> <span class="n">uniform_dist</span>
<span class="kn">from</span> <span class="nn">eryn.moves</span> <span class="kn">import</span> <span class="n">GaussianMove</span>
<span class="kn">from</span> <span class="nn">eryn.backends</span> <span class="kn">import</span> <span class="n">HDFBackend</span>

<span class="c1"># make the plots look a bit nicer with some defaults</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">rcparams</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">rcparams</span><span class="p">[</span><span class="s2">&quot;axes.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">rcparams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;serif&quot;</span>
<span class="n">rcparams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">rcparams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">rcparams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;stix&quot;</span>
<span class="n">rcparams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rcparams</span><span class="p">)</span> <span class="c1"># update plot parameters</span>

<span class="c1"># set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">chainconsumer</span> <span class="kn">import</span> <span class="n">ChainConsumer</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
</pre></div>
</div>
</div>
<section id="Searching-for-Gaussian-pulses-in-2D">
<h2>Searching for Gaussian pulses in 2D<a class="headerlink" href="#Searching-for-Gaussian-pulses-in-2D" title="Link to this heading"></a></h2>
<p>In this simple example we generate a noisy figure, which contains signals in the shape of 2D Gaussian pulses. We will attempt to estimate the nubmer of signals, as well as the level of the synthetic noise. First, we generate the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num</span>     <span class="o">=</span> <span class="mi">100</span> <span class="c1"># the number of step for each dimension</span>
<span class="n">lowlim</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">10</span> <span class="c1"># Low limit on each axis</span>
<span class="n">highlim</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># high limit on each axis</span>
<span class="n">npulses</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># The # of injected pulses</span>

<span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">highlim</span> <span class="o">-</span> <span class="n">lowlim</span><span class="p">)</span><span class="o">/</span><span class="n">num</span> <span class="c1"># Get the discritization</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">lowlim</span><span class="p">:</span><span class="n">highlim</span><span class="p">:</span><span class="n">dx</span><span class="p">,</span> <span class="n">lowlim</span><span class="p">:</span><span class="n">highlim</span><span class="p">:</span><span class="n">dx</span><span class="p">]</span> <span class="c1"># Generate the grid</span>
</pre></div>
</div>
</div>
<p>Now we define the parameters of the injection signals</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Amp</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">npulses</span><span class="p">))</span> <span class="c1"># Draw an amplitude</span>
<span class="n">spread</span> <span class="o">=</span> <span class="mf">.2</span>  <span class="c1"># Keep their spread as fixed for simplicity.</span>
<span class="n">sigma</span>  <span class="o">=</span> <span class="n">spread</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Do the actual injection</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Utility parameter, in order to avoid having signals at the border of our data set</span>

<span class="c1"># Draw the coordinates parameters</span>
<span class="n">inj_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">lowlim</span><span class="o">+</span><span class="n">edges</span><span class="p">,</span> <span class="n">highlim</span><span class="o">-</span><span class="n">edges</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">npulses</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Gather all parameters here</span>
<span class="n">gauss_inj_params</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">AA</span><span class="p">,</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">AA</span><span class="p">,</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Amp</span><span class="p">,</span> <span class="n">inj_coordinates</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; * Parameters injected: </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 * Parameters injected:

 [[ 0.87454012 -7.67064809  7.51855763]
 [ 1.45071431  5.31908225 -4.60257423]
 [ 1.23199394 -5.09080052 -5.06552784]
 [ 1.09865848 -3.13212411  0.39610291]
 [ 0.65601864 -1.0888797  -3.34033376]
 [ 0.65599452  1.78964632 -5.76809823]
 [ 0.55808361 -3.32568562 -2.13821051]
 [ 1.36617615 -0.70288025  4.56281538]
 [ 1.10111501 -4.80521949  0.22775101]
 [ 1.20807258  1.4786331  -7.2567934 ]]
</pre></div></div>
</div>
<p>We then can define the model and likelihood functions</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First we compute some constant terms of the Gaussian models (reminder: we have assumed a fixed spread for each pulse)</span>
<span class="n">sigma_det</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">sigma_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">norm</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_det</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gaussian_flat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
    <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span>
    <span class="c1"># This einsum call calculates (x-mu)T.Sigma-1.(x-mu) in a vectorized</span>
    <span class="c1"># way across all the input variables.</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...k,kl,...l-&gt;...&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma_inv</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="n">fac</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="c1"># breakpoint()</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># breakpoint()</span>
    <span class="n">C</span> <span class="o">=</span>  <span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,:]</span> <span class="c1"># (np.expand_dims(A,axis=0) * np.expand_dims(np.transpose(B),axis=2))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">a</span> <span class="o">*</span> <span class="n">C</span> <span class="o">/</span> <span class="n">norm</span> <span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">log_prob_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_inds</span><span class="o">=</span><span class="p">[],</span> <span class="n">fill_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">group1</span><span class="p">,</span> <span class="n">group2</span> <span class="o">=</span> <span class="n">groups</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">num</span> <span class="o">*</span> <span class="n">num</span>

    <span class="n">gauss_out</span>  <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">num_groups</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">group1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">template</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_groups</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">num</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_groups</span><span class="p">):</span>
        <span class="n">inds1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">group1</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">given_signal</span> <span class="o">=</span> <span class="n">gauss_out</span><span class="p">[:,:,</span><span class="n">inds1</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">template</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">given_signal</span>

    <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x2</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">llh</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">template</span> <span class="o">-</span> <span class="n">data</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">)</span>
    <span class="n">llh</span> <span class="o">*=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">llh</span> <span class="o">+=</span> <span class="o">-</span> <span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">llh</span>
</pre></div>
</div>
</div>
<p>We then generate the noise and add our injections.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_noise</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.2</span><span class="p">]]</span> <span class="c1"># The nosie variance</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">sigma_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span> <span class="n">num</span><span class="p">,</span> <span class="n">num</span> <span class="p">)</span> <span class="c1"># Draw the random points for the noise</span>

<span class="c1"># Generate the data-set</span>
<span class="n">injection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">gauss_inj_params</span><span class="p">:</span>
    <span class="n">injection</span> <span class="o">+=</span> <span class="n">gaussian_flat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">injection</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Plot everything below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">injection</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">PuBu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">params</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#DC143C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">PuBu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">params</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#DC143C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_13_0.png" src="../_images/tutorial_more_tutorials_13_0.png" />
</div>
</div>
<p>We then need to configure models and set-up our sample, in a very similar manner as we did for the simpler case before. Like in the previous case, we have two models that we need to sample for. One refers to the pulse signals, which we need to also estimate their total number in the data, and the other is the overal noise (no dynamical parameter space here).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndims</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>           <span class="c1"># The dimensions of the two models we sample for here (# of parameter for each pulse, and # of parameters for the noise)</span>
<span class="n">nleaves_max</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">npulses</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>   <span class="c1"># Maximum number of components for each model type (noise is 1, because we don&#39;t want to use RJ MCMC on it).</span>
<span class="n">branch_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pulse&quot;</span><span class="p">,</span> <span class="s2">&quot;noise&quot;</span><span class="p">]</span>

<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pulse&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="n">lowlim</span><span class="p">,</span> <span class="n">highlim</span><span class="p">),</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="n">lowlim</span><span class="p">,</span> <span class="n">highlim</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Below we generate the coordinates for each walker, as done before. First we need to define the number of Temperatures and walkers we want to use.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntemps</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">branch_names</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">sig1</span> <span class="o">=</span> <span class="mf">0.0000001</span>
<span class="k">for</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">branch_names</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nleaf</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pulse&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">):</span>
                <span class="n">kk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">npulses</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kk</span> <span class="o">=</span> <span class="n">nn</span>
            <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">gauss_inj_params</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">sigma_noise</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">))</span>


<span class="n">inds</span> <span class="o">=</span> <span class="p">{</span>
     <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaf</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">,</span> <span class="n">branch_names</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">inds</span><span class="p">[</span><span class="s1">&#39;pulse&#39;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">inds_temp</span> <span class="ow">in</span> <span class="n">inds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">inds_fix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inds_temp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inds_fix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds_fix</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">inds_temp</span><span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">coords</span>
<span class="p">}</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">groups</span>
<span class="p">}</span>

<span class="n">coords_in</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">inds</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">}</span>
<span class="n">groups_in</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">groups</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">inds</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">}</span>

<span class="c1"># We compute the initial likelihood value at the injected coordinates:</span>
<span class="n">log_prob</span> <span class="o">=</span> <span class="n">log_prob_fn</span><span class="p">(</span>
    <span class="p">[</span><span class="n">coords_in</span><span class="p">[</span><span class="s2">&quot;pulse&quot;</span><span class="p">],</span> <span class="n">coords_in</span><span class="p">[</span><span class="s2">&quot;noise&quot;</span><span class="p">]],</span>
    <span class="p">[</span><span class="n">groups_in</span><span class="p">[</span><span class="s2">&quot;pulse&quot;</span><span class="p">],</span> <span class="n">groups_in</span><span class="p">[</span><span class="s2">&quot;noise&quot;</span><span class="p">]],</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">fill_inds</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">fill_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>What remains is to sample the dynamical parameter space! One last thing: Define proposal and initial temperature ladder:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factor</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">cov</span>    <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pulse&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span>
          <span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">factor</span><span class="p">}</span>
<span class="n">moves</span> <span class="o">=</span> <span class="n">GaussianMove</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
<span class="n">betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ntemps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Begin sampling. This might take a while, so you can reduce the <code class="docutils literal notranslate"><span class="pre">burnin</span></code> and <code class="docutils literal notranslate"><span class="pre">nsteps</span></code> to get a quick result. With current settings it ight take between 2 - 5 minutes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span>
    <span class="n">ndims</span><span class="p">,</span>  <span class="c1"># assumes ndim_max</span>
    <span class="n">log_prob_fn</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="p">],</span>
    <span class="n">tempering_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">),</span>
    <span class="n">nbranches</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">branch_names</span><span class="p">),</span>
    <span class="n">branch_names</span><span class="o">=</span><span class="n">branch_names</span><span class="p">,</span>
    <span class="n">nleaves_max</span><span class="o">=</span><span class="n">nleaves_max</span><span class="p">,</span>
    <span class="n">provide_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">update_iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">plot_iterations</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">moves</span><span class="o">=</span><span class="n">moves</span><span class="p">,</span>
    <span class="n">rj_moves</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># Number of samples per walker</span>

<span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">log_like</span><span class="o">=</span><span class="n">log_prob</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">),</span> <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">,</span> <span class="n">blobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">inds</span><span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin_by</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 100/100 [00:14&lt;00:00,  7.01it/s]
100%|██████████| 500/500 [02:26&lt;00:00,  3.41it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;eryn.state.State at 0x7ff61a97edc0&gt;
</pre></div></div>
</div>
<p>We then plot the results below</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_clean_chain</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple utility function to extract the squeezed chains for all the parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">naninds</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="n">temp</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
    <span class="n">samples_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">coords</span><span class="p">[:,</span> <span class="n">temp</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">naninds</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ndim</span><span class="p">))</span>  <span class="c1"># init the chains to plot</span>
    <span class="c1"># get the samples to plot</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
        <span class="n">givenparam</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="n">temp</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">samples_in</span><span class="p">[:,</span> <span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">givenparam</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">givenparam</span><span class="p">))</span>
        <span class="p">]</span>  <span class="c1"># Discard the NaNs, each time they change the shape of the samples_in</span>
    <span class="k">return</span> <span class="n">samples_in</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pulse_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$A$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$y$&quot;</span><span class="p">]</span>
<span class="n">noise_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$\sigma_\mathrm</span><span class="si">{noise}</span><span class="s2">$&quot;</span><span class="p">]</span>

<span class="n">samples_pulses</span> <span class="o">=</span> <span class="n">get_clean_chain</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;pulse&#39;</span><span class="p">],</span> <span class="n">ndims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">samples_noise</span> <span class="o">=</span> <span class="n">get_clean_chain</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;noise&#39;</span><span class="p">],</span> <span class="n">ndims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">ChainConsumer</span><span class="p">()</span>

<span class="n">c</span><span class="o">.</span><span class="n">add_chain</span><span class="p">(</span><span class="n">samples_pulses</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">pulse_parameters</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pulses&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#6495ed&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bar_shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tick_font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label_font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_ticks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">serif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npulses</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_marker</span><span class="p">([</span><span class="n">gauss_inj_params</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">gauss_inj_params</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">gauss_inj_params</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span> \
    <span class="n">parameters</span><span class="o">=</span><span class="n">pulse_parameters</span><span class="p">,</span> <span class="n">marker_style</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> \
    <span class="n">marker_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#DC143C&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:chainconsumer:Configure has been called 2 times - this is not good - it should be once!
WARNING:chainconsumer:To avoid this, load your chains in first, then call analysis/plotting methods
WARNING:chainconsumer:Parameter $A$ in chain Pulses is not constrained
WARNING:chainconsumer:Parameter $x$ in chain Pulses is not constrained
WARNING:chainconsumer:Parameter $y$ in chain Pulses is not constrained
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_26_1.png" src="../_images/tutorial_more_tutorials_26_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">ChainConsumer</span><span class="p">()</span>

<span class="n">c</span><span class="o">.</span><span class="n">add_chain</span><span class="p">(</span><span class="n">samples_noise</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">noise_parameters</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;noise&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bar_shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tick_font_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label_font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">max_ticks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">serif</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">truth</span><span class="o">=</span><span class="n">sigma_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_27_0.png" src="../_images/tutorial_more_tutorials_27_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_clean_k_chains</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A simple function to get the chains of model order k</span>

<span class="sd">    Args:</span>
<span class="sd">        backend: The Eryn backend</span>

<span class="sd">    Returns:</span>
<span class="sd">        k_chain: the chains of the k order</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;inds&quot;</span><span class="p">)</span>  <span class="c1"># Get the leaves out</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">branch</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">branches</span><span class="p">):</span>  <span class="c1"># Get the total number of components/branches per temperature</span>
        <span class="k">if</span> <span class="n">branch</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">branches</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">k_chain</span> <span class="o">=</span> <span class="n">branches</span><span class="p">[</span><span class="n">branch</span><span class="p">][:,</span> <span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k_chain</span> <span class="o">+=</span> <span class="n">branches</span><span class="p">[</span><span class="n">branch</span><span class="p">][:,</span> <span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">k_chain</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gauss_k_chain_baseline</span> <span class="o">=</span> <span class="n">get_clean_k_chains</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>

<span class="n">bns</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nleaves_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Get maximum allowed number of leaves for the given branch</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">gauss_k_chain_baseline</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">bns</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#6495ed&#39;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;///&#39;</span>
        <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">npulses</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#DC143C&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\#$ of peaks in the data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_29_0.png" src="../_images/tutorial_more_tutorials_29_0.png" />
</div>
</div>
</section>
<section id="Choosing-the-optimal-B-Spline-order">
<h2>Choosing the optimal B-Spline order<a class="headerlink" href="#Choosing-the-optimal-B-Spline-order" title="Link to this heading"></a></h2>
<p>In this section we will attempt to fit a spectrum using a shape-agnostic model based on B-spline interpolation. The motivation of the problem is to determine the optimal number of free knots that are best describing the data, avoiding over-fitting situations. A very useful package is <a class="reference external" href="https://github.com/karnesis/spectral">this</a> one, which is a simple package for performing spectral analysis. Has a lot of window functions, but more importantly, it contains the log-PSD function, which we will
use in order to reduce the computational complexity of the problem. For more invormation about the <code class="docutils literal notranslate"><span class="pre">lpsd</span></code> method you can check <a class="reference external" href="https://pure.mpg.de/rest/items/item_150688/component/file_150687/content">this</a> paper.</p>
<p>First we set-up the type of measurement. The duration, cadence, also try to define the total number of steps for our sampler.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Tobs</span>  <span class="o">=</span> <span class="mf">1e6</span>                     <span class="c1"># Duration of data</span>
<span class="n">dt</span>    <span class="o">=</span> <span class="mi">10</span>                      <span class="c1"># Delta-t [s]</span>
<span class="n">fs</span>    <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span>                    <span class="c1"># Sampling frequency</span>
<span class="n">Ndata</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Tobs</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>            <span class="c1"># Number of data points</span>
<span class="n">tvec</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Tobs</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># Get the time vector</span>
<span class="n">df</span>    <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">Tobs</span>                <span class="c1"># Define Delta-f</span>
<span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">nsteps</span><span class="o">=</span><span class="mi">2000</span>
</pre></div>
</div>
</div>
<p>We then need to simulate some time-series. We could totally do this directly in frequency domain, but we will generate synthetic time series in order to use the <code class="docutils literal notranslate"><span class="pre">lpsd</span></code> function, which is useful for now. We start by defining our “true”, or “theoretical” PSD of the data, which we will use to generate our data-set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="k">if</span> <span class="p">(</span><span class="n">Ndata</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>              <span class="c1"># Get the number of requencies</span>
    <span class="n">nfft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">Ndata</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">nfft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">Ndata</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="n">F</span>     <span class="o">=</span> <span class="n">df</span><span class="o">*</span><span class="n">nfft</span>                 <span class="c1"># make the positive frequency vector</span>
<span class="n">fvec</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="c1"># Define a smooth model for the PSD of the noise</span>
<span class="n">fstar</span><span class="o">=</span><span class="mf">8e-3</span>
<span class="n">n1</span><span class="o">=-</span><span class="mi">5</span>
<span class="n">n2</span><span class="o">=</span><span class="mi">5</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">noisemodel</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span> <span class="p">:</span> <span class="mf">1e-3</span><span class="o">/</span><span class="n">f</span> <span class="o">+</span> <span class="mi">50</span><span class="o">*</span><span class="n">f</span> <span class="o">+</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="o">**</span><span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">fstar</span><span class="o">**</span><span class="n">n1</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="n">n2</span> <span class="o">+</span> <span class="n">fstar</span><span class="o">**</span><span class="n">n2</span> <span class="o">*</span> <span class="n">f</span><span class="o">**</span><span class="n">n1</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># Get the PSD of the noise using hte model above</span>
<span class="n">Sn</span> <span class="o">=</span> <span class="n">noisemodel</span><span class="p">(</span><span class="n">fvec</span><span class="p">)</span>

<span class="c1"># Remove first nan (assume also zero-mean)</span>
<span class="n">Sn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1282363938.py:14: RuntimeWarning: divide by zero encountered in true_divide
  noisemodel = lambda f : 1e-3/f + 50*f + amp * (f**(n1 + n2) / (fstar**n1 * f**n2 + fstar**n2 * f**n1) )
/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1282363938.py:14: RuntimeWarning: divide by zero encountered in power
  noisemodel = lambda f : 1e-3/f + 50*f + amp * (f**(n1 + n2) / (fstar**n1 * f**n2 + fstar**n2 * f**n1) )
</pre></div></div>
</div>
<p>Import the spectral module for convenience. It contains tons of windows and some spectral utility functions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spectral</span> <span class="kn">import</span> <span class="n">genTimeSeriesFromPSD</span><span class="p">,</span> <span class="n">lpsd</span><span class="p">,</span> <span class="n">welchpsd</span>
</pre></div>
</div>
</div>
<p>We generate the time-series by <code class="docutils literal notranslate"><span class="pre">ifft</span></code>-ing from the PSD model we provided. We then compute the PSD of the data using hte Welch method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">navs</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1">## Generate time-series here</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> # Generating noisy data with </span><span class="se">\n\t</span><span class="s1"> Tobs: </span><span class="si">{}</span><span class="s1"> </span><span class="se">\n\t</span><span class="s1">Ndata: </span><span class="si">{}</span><span class="s1"> </span><span class="se">\n\t</span><span class="s1">  dt: </span><span class="si">{}</span><span class="s1"> </span><span class="se">\n\t</span><span class="s1">  df: </span><span class="si">{}</span><span class="se">\n\t</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Tobs</span><span class="p">,</span> <span class="n">Ndata</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>
<span class="n">my_data</span> <span class="o">=</span> <span class="n">genTimeSeriesFromPSD</span><span class="p">(</span><span class="n">Sn</span><span class="p">,</span><span class="n">fs</span><span class="p">)</span> <span class="c1"># I divide by two because the function assumes the 2-sided spectrum</span>

<span class="n">f20</span><span class="p">,</span> <span class="n">S20</span> <span class="o">=</span> <span class="n">welchpsd</span><span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ndata</span><span class="o">/</span><span class="n">navs</span><span class="p">),</span> <span class="n">win</span><span class="o">=</span><span class="s1">&#39;nuttall4c&#39;</span><span class="p">)</span>
<span class="n">fr1</span><span class="p">,</span> <span class="n">S1</span> <span class="o">=</span> <span class="n">welchpsd</span><span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">Ndata</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="s1">&#39;nuttall4c&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 # Generating noisy data with
         Tobs: 1000000.0
        Ndata: 100000
          dt: 10
          df: 1e-06

</pre></div></div>
</div>
<p>In order to save some computatational time, we use the <code class="docutils literal notranslate"><span class="pre">lpsd</span></code> method, which is basically a method to compute the PSD of time-series, using the optimal number of averages at each frequeny. The frequency grid is equally spaced in log, and pre-defined. For more information, you can tcheck <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S026322410500117X?via%3Dihub">this</a> paper.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f0</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">f1</span> <span class="o">=</span> <span class="mf">5e-2</span>

<span class="n">fl</span><span class="p">,</span> <span class="n">Sl</span><span class="p">,</span> <span class="n">Sle</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Kavs</span> <span class="o">=</span> <span class="n">lpsd</span><span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">Kdes</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Jdes</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">],</span> <span class="n">win</span><span class="o">=</span><span class="s1">&#39;nuttall4b&#39;</span><span class="p">,</span> <span class="n">winalpha</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">olap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">errrype</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">DOPLOT</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">VERBOSE</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">errs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">Sle</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">Sle</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">fr1</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Numerically calculated PSD, with N=1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">f20</span><span class="p">,</span> <span class="n">S20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Numerically calculated PSD, with N=</span><span class="si">{</span><span class="n">navs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">Sl</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;logPSD&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">fvec</span><span class="p">,</span> <span class="n">Sn</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;My PSD theoretical model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">fvec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;[1/Hz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7ff62dd829d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_41_1.png" src="../_images/tutorial_more_tutorials_41_1.png" />
</div>
</div>
<p>Now we setting up the sampler.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxmodels</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">ntemps</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">backendname</span> <span class="o">=</span> <span class="s1">&#39;a_test&#39;</span>
</pre></div>
</div>
</div>
<p>For this investigation, we need two models. One model concerns the knots at the edges of the spectrum, which we only do parameter estimation for their respective amplitude. So, no reversible jump for this one. We do this by simply setting the maximum number of leaves to <code class="docutils literal notranslate"><span class="pre">1</span></code>. The second model is the one that is dynamic, each component having an amplitude and a position parameter. We call those models <code class="docutils literal notranslate"><span class="pre">edges</span></code> and <code class="docutils literal notranslate"><span class="pre">knots</span></code> respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndims</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># The first is control point + knot, the second two control points (knots are the edges)</span>
<span class="n">nleaves_max</span>  <span class="o">=</span> <span class="p">[</span><span class="n">maxmodels</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">nleaves_min</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">branch_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;knots&quot;</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">]</span>

<span class="c1"># Restrict the frequency band</span>
<span class="n">i_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">fl</span><span class="o">&gt;=</span><span class="n">f0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fl</span><span class="o">&lt;=</span><span class="n">f1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">noisemodel</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">i_band</span><span class="p">])))</span>
<span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">noisemodel</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">i_band</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;max:&#39;</span><span class="p">,</span> <span class="n">mx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min:&#39;</span><span class="p">,</span> <span class="n">mn</span><span class="p">)</span>

<span class="c1">#The prior on the knot amplitude could be dependent on the frequency, but I choose</span>
<span class="c1">#to be simple here</span>
<span class="n">priors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;knots&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f1</span><span class="p">)),</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mn</span><span class="p">,</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">mx</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mn</span><span class="p">,</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">noisemodel</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">uniform_dist</span><span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">mn</span><span class="p">,</span> <span class="mf">1.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">noisemodel</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max: 2.2400506683151953
min: -0.7418475507541406
</pre></div></div>
</div>
<p>Setting up the input coordinates. This might be easier in the future, but hte functionality should remain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="c1"># Initialize the knots fr,</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">branch_names</span><span class="p">)</span>
<span class="p">}</span>


<span class="n">sig1</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="k">for</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">branch_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">{}</span><span class="s1">: Max models = </span><span class="si">{}</span><span class="s1">, dim = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nleaf</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;knots&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">dd</span><span class="p">]</span> <span class="o">=</span> <span class="n">priors</span><span class="p">[</span><span class="s1">&#39;knots&#39;</span><span class="p">][</span><span class="n">dd</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span><span class="n">nwalkers</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">dd</span><span class="p">]</span> <span class="o">=</span> <span class="n">priors</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">][</span><span class="n">dd</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span><span class="n">nwalkers</span><span class="p">))</span> <span class="c1"># np.random.multivariate_normal(edges_starting_params[nn], np.diag(np.ones(2) * sig1), size=(ntemps, nwalkers))</span>

<span class="n">indxs</span> <span class="o">=</span> <span class="p">{</span>
     <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">,</span> <span class="n">nleaf</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">nleaf</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nleaves_max</span><span class="p">,</span> <span class="n">branch_names</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">indxs</span><span class="p">[</span><span class="s1">&#39;knots&#39;</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">inds_temp</span> <span class="ow">in</span> <span class="n">indxs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">inds_fix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inds_temp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inds_fix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds_fix</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">inds_temp</span><span class="p">[</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">coords</span>
<span class="p">}</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">groups</span>
<span class="p">}</span>

<span class="n">coords_in</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">coords</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">indxs</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">}</span>
<span class="n">groups_in</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">groups</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">indxs</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# knots: Max models = 20, dim = 2
# edges: Max models = 1, dim = 2
</pre></div></div>
</div>
<p>Now we need to define the likelihood function. It hadles</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SplineLikelihood</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">inf</span><span class="o">=</span><span class="mf">1e14</span><span class="p">,</span> <span class="n">expmax</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gaussian likelihood model using a log-periodogram.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">         fr : (ndarray) frequency array of the estimation domain, size nf</span>
<span class="sd">        per : (ndarray) periodogram array, size nf</span>
<span class="sd">          N : (ndarray) array of averages per frequency, size nf</span>
<span class="sd">        var : (float) variance of the log-periodogram bins</span>
<span class="sd">        inf : (float or np.inf) if the likelihood diverges, it will be set equal to - inf</span>
<span class="sd">     expmax : (float) maximum value allowed in the exponential function. If this is reached, the log-likelihood will return -infinity.</span>
<span class="sd">       kind : (string) Interpolation kind. Set to &#39;cubic&#39; by default.</span>
<span class="sd">       ftol : (float [ 0 &lt; ftol]) Tolerance on proximity of knots in logspace</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Frequency of data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>   <span class="o">=</span> <span class="n">freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Nsegs</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
        <span class="c1"># Discrete Fourier transform of data (already normalized)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per</span> <span class="o">=</span> <span class="n">per</span>
        <span class="c1"># Maximum value allowed in the exponential function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expmax</span> <span class="o">=</span> <span class="n">expmax</span>
        <span class="c1"># Interpolation kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="c1"># tolerance on proximity of knots in logspace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftol</span> <span class="o">=</span> <span class="n">ftol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inf</span> <span class="o">=</span> <span class="n">inf</span>

    <span class="k">def</span> <span class="nf">get_noise_psd_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spline model for the noise PSD, given some knots</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, groups : (ndarray) PSD parameters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psd_model : interpolate.interp1d evaluated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># I will consider two models. One handling the internal knots, and one for the edges</span>
        <span class="n">internal_knots_parameters</span><span class="p">,</span> <span class="n">control_points_edges</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">group1</span><span class="p">,</span> <span class="n">group2</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="n">knots</span> <span class="o">=</span> <span class="n">internal_knots_parameters</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">control_points</span> <span class="o">=</span> <span class="n">internal_knots_parameters</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">num_groups</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">group1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># log_psd_model = np.zeros((num_groups, len(self.freq)))</span>
        <span class="n">log_psd_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_groups</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)))</span>
        <span class="n">log_psd_model</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># Loop over the temperatures vs walkers</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_groups</span><span class="p">):</span>
            <span class="n">inds1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">group1</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">knots_i</span> <span class="o">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">inds1</span><span class="p">]</span>
            <span class="n">control_points_i</span> <span class="o">=</span> <span class="n">control_points</span><span class="p">[</span><span class="n">inds1</span><span class="p">]</span>

            <span class="n">inds2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">group2</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">control_points_edges_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">control_points_edges</span><span class="p">[</span><span class="n">inds2</span><span class="p">])</span>

            <span class="c1"># Remove zeros</span>
            <span class="n">knots_i</span>  <span class="o">=</span> <span class="n">knots_i</span><span class="p">[</span><span class="n">knots_i</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">]</span>
            <span class="n">control_points_i</span> <span class="o">=</span> <span class="n">control_points_i</span><span class="p">[</span><span class="n">control_points_i</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">]</span>

            <span class="n">knots_list</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">logfr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">knots_i</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">logfr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">control_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">control_points_edges_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">control_points_i</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">control_points_edges_i</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

            <span class="c1"># Control for knots very close to each other</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">knots_list</span><span class="p">))</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftol</span><span class="p">):</span>
                <span class="c1"># Change the data and reset the spline class</span>
                <span class="n">interp_model</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">knots_list</span><span class="p">,</span> <span class="n">control_pts</span><span class="p">,</span>
                                                    <span class="n">kind</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                    <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                    <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">,</span>
                                                    <span class="n">assume_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">log_psd_model</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfr</span><span class="p">)</span>

                <span class="c1"># To prevent overflow</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">log_psd_model</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expmax</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[Overflow!]&#39;</span><span class="p">)</span>
                    <span class="n">i_over</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">log_psd_model</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expmax</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">log_psd_model</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="n">log_psd_model</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i_over</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Return the correct quantity</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_psd_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the log-likelihood.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">             x : (ndarray) vector of spline parameters.</span>
<span class="sd">        groups : (ndarray) vector of groups parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">             L : (ndarray) log-likelihood value at x, groups computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compute PSD model</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_noise_psd_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>

        <span class="c1"># Get the normalisation constants</span>
        <span class="n">log2pi</span> <span class="o">=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="c1"># Log-likelihood calculation</span>
        <span class="n">L</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">per</span> <span class="o">/</span> <span class="n">C</span>

        <span class="c1"># Sum with the normalization factor here</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="mf">.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nsegs</span> <span class="o">*</span> <span class="p">(</span> <span class="n">L</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">+</span> <span class="n">log2pi</span><span class="p">),</span> <span class="n">nan</span><span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">L</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="n">L</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate and initalize likelihood again with different ftol</span>
<span class="n">psdlike</span> <span class="o">=</span> <span class="n">SplineLikelihood</span><span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">i_band</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Sl</span><span class="p">[</span><span class="n">i_band</span><span class="p">]),</span> <span class="n">Kavs</span><span class="p">[</span><span class="n">i_band</span><span class="p">],</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">.05</span><span class="p">)</span>

<span class="n">liekeval</span> <span class="o">=</span> <span class="n">psdlike</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">coords_in</span><span class="p">[</span><span class="s2">&quot;knots&quot;</span><span class="p">],</span> <span class="n">coords_in</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">groups_in</span><span class="p">[</span><span class="s2">&quot;knots&quot;</span><span class="p">],</span> <span class="n">groups_in</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;llh shape = &#39;</span><span class="p">,</span> <span class="n">liekeval</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;liekeval = &#39;</span><span class="p">,</span> <span class="n">liekeval</span><span class="p">)</span>

<span class="n">log_prob</span> <span class="o">=</span> <span class="n">liekeval</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ntemps</span><span class="p">,</span> <span class="n">nwalkers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
llh shape =  (100,)
liekeval =  [-4.29905751e+06 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -4.37617254e+06 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -4.30751294e+06 -4.31923024e+06 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -4.31360092e+06 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -4.32508567e+06 -1.00000000e+14 -4.45639724e+06 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -4.46121449e+06 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14
 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14 -1.00000000e+14]
</pre></div></div>
</div>
<p>Now run the sampler!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">betas</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ntemps</span><span class="p">)</span>
<span class="n">factor</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">cov</span>    <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;knots&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span>
          <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">factor</span><span class="p">}</span>

<span class="n">moves</span> <span class="o">=</span> <span class="n">GaussianMove</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">HDFBackend</span><span class="p">(</span><span class="n">backendname</span> <span class="o">+</span> <span class="s2">&quot;.h5&quot;</span><span class="p">)</span>

<span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span>
    <span class="n">ndims</span><span class="p">,</span>  <span class="c1"># assumes ndim_max</span>
    <span class="n">psdlike</span><span class="o">.</span><span class="n">evaluate</span><span class="p">,</span>
    <span class="n">priors</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tempering_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">),</span>
    <span class="n">nbranches</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">branch_names</span><span class="p">),</span>
    <span class="n">branch_names</span><span class="o">=</span><span class="n">branch_names</span><span class="p">,</span>
    <span class="n">nleaves_max</span><span class="o">=</span><span class="n">nleaves_max</span><span class="p">,</span>
    <span class="n">nleaves_min</span><span class="o">=</span><span class="n">nleaves_min</span><span class="p">,</span>
    <span class="n">provide_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">update_iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">plot_iterations</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">moves</span><span class="o">=</span><span class="n">moves</span><span class="p">,</span>
    <span class="n">rj_moves</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; * Started sampling ...&#39;</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">log_like</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">,</span> <span class="n">blobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inds</span><span class="o">=</span><span class="n">indxs</span><span class="p">)</span>

<span class="n">ensemble</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="n">burnin</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin_by</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; * Finished sampling!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 * Started sampling ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 18%|█▊        | 184/1000 [00:03&lt;00:15, 53.85it/s]/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1577252010.py:111: RuntimeWarning: divide by zero encountered in true_divide
  L = -1.* self.per / C
/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1577252010.py:111: RuntimeWarning: overflow encountered in true_divide
  L = -1.* self.per / C
/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1577252010.py:114: RuntimeWarning: divide by zero encountered in log
  L = np.nan_to_num(.5 * self._Nsegs * ( L - np.log(C) + log2pi), nan= -np.inf)
/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1577252010.py:114: RuntimeWarning: invalid value encountered in subtract
  L = np.nan_to_num(.5 * self._Nsegs * ( L - np.log(C) + log2pi), nan= -np.inf)
/Users/nikos/work/programs/anaconda3/lib/python3.9/site-packages/numpy/core/fromnumeric.py:86: RuntimeWarning: overflow encountered in reduce
  return ufunc.reduce(obj, axis, dtype, out, **passkwargs)
 61%|██████    | 612/1000 [00:11&lt;00:07, 51.11it/s]/var/folders/yz/xf637mpx56g2dvdv9d8v1fnm0000gn/T/ipykernel_3250/1577252010.py:114: RuntimeWarning: overflow encountered in multiply
  L = np.nan_to_num(.5 * self._Nsegs * ( L - np.log(C) + log2pi), nan= -np.inf)
100%|██████████| 1000/1000 [00:19&lt;00:00, 52.54it/s]
 46%|████▌     | 911/2000 [00:27&lt;00:32, 33.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Overflow!]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [01:00&lt;00:00, 33.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 * Finished sampling!
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline_run_backend</span> <span class="o">=</span> <span class="n">HDFBackend</span><span class="p">(</span><span class="n">backendname</span> <span class="o">+</span> <span class="s2">&quot;.h5&quot;</span><span class="p">)</span> <span class="c1"># Load the data from disk</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">ndim_knots</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Set the dimensionality of each model</span>
<span class="n">ndim_edges</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">samples_knots</span> <span class="o">=</span> <span class="n">get_clean_chain</span><span class="p">(</span><span class="n">baseline_run_backend</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;knots&#39;</span><span class="p">],</span> <span class="n">ndim_knots</span><span class="p">)</span>
<span class="n">samples_edges</span> <span class="o">=</span> <span class="n">get_clean_chain</span><span class="p">(</span><span class="n">baseline_run_backend</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[</span><span class="s1">&#39;edges&#39;</span><span class="p">],</span> <span class="n">ndim_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Plot the “squeezed” posterior surface for our parameters, for all <code class="docutils literal notranslate"><span class="pre">k</span></code> models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">paramnames</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\log f_{j,k}$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\log S_{j,k}$&#39;</span><span class="p">]</span> <span class="c1"># Define parameter names</span>

<span class="n">i_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">f20</span><span class="o">&gt;=</span><span class="n">f0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f20</span><span class="o">&lt;=</span><span class="n">f1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Keep only the range which we fitted in</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">ChainConsumer</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">add_chain</span><span class="p">(</span><span class="n">samples_knots</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">paramnames</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Knots in-between&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bar_shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_hists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
<span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f20</span><span class="p">[</span><span class="n">i_band</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f20</span><span class="p">[</span><span class="n">i_band</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">ax_list</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">noisemodel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ff</span><span class="p">))),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># Update this becasue chaincnsumer is annoyinh</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_56_0.png" src="../_images/tutorial_more_tutorials_56_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knots_k_chain</span> <span class="o">=</span> <span class="n">get_clean_k_chains</span><span class="p">(</span><span class="n">baseline_run_backend</span><span class="p">)</span>

<span class="n">bns</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxmodels</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Get maximum allowed number of leaves for the given branch</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># Update this becasue chaincnsumer is annoying</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">probs</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">rects</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">knots_k_chain</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="n">bns</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
        <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;////&#39;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;knots in-between&#39;</span>
        <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxmodels</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\#$ of free knots&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;$\\#$ of free knots&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_more_tutorials_57_1.png" src="../_images/tutorial_more_tutorials_57_1.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(\sim fin \sim\)</span></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Eryn_tutorial.html" class="btn btn-neutral float-left" title="Eryn Basic Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../general/todos.html" class="btn btn-neutral float-right" title="Code Projects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Michael Katz and Nikos Karnesis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>